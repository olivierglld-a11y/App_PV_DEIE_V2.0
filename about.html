<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>√Ä propos - Essais DEIE</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="style.css?v=20260217">
</head>

<body>

  <!-- HEADER BLEU -->
  <header class="header">
    <img src="enedis.png" alt="Enedis" class="logo">
    <h1>Essais DEIE</h1>
    <p>√Ä propos</p>
  </header>

  <!-- CONTENU -->
  <main class="container">

    <section class="card">
      <h2>üì± Application Essais DEIE</h2>
      <p style="text-align: center; font-size: 1.5rem; font-weight: bold; color: #1424DB; margin: 20px 0;">
        Version 1.1
      </p>
      <p style="text-align: center; color: #666; margin-bottom: 30px;">
        F√©vrier 2026
      </p>
    </section>

    <section class="card">
      <h2>üë§ Auteur</h2>
      <p style="font-size: 1.1rem; margin: 15px 0;">
        <strong>Olivier Guillemard</strong>
      </p>
      <p style="color: #666;">
        D√©veloppeur de l'application
      </p>
    </section>

    <section class="card">
      <h2>üìú Droits d'auteur</h2>
      <p style="margin: 15px 0;">
        <strong>Copyright ¬© 2026 Olivier Guillemard</strong>
      </p>
      <p style="color: #666; margin: 10px 0;">
        Tous droits r√©serv√©s. Cette application et son code source sont la propri√©t√© exclusive de l'auteur.
      </p>
      <div style="background-color: #fff3cd; border-left: 4px solid #ffc107; padding: 15px; margin: 20px 0; border-radius: 6px;">
        <p style="margin: 0; font-weight: bold; color: #856404;">
          ‚ö†Ô∏è Usage interne ENEDIS uniquement
        </p>
        <p style="margin: 10px 0 0 0; color: #856404; font-size: 0.9rem;">
          Toute reproduction, modification ou redistribution non autoris√©e est strictement interdite.
        </p>
      </div>
    </section>

    <section class="card">
      <h2>üìã Description</h2>
      <p style="margin: 15px 0; line-height: 1.6;">
        Application web mobile pour la gestion et la documentation des proc√©dures d'essais DEIE 
        (Dispositif d'√âchange d'Information d'Exploitation) conformes aux normes ENEDIS.
      </p>
      <h3 style="color: #1424DB; margin-top: 20px;">Fonctionnalit√©s principales :</h3>
      <ul style="line-height: 1.8; margin-left: 20px;">
        <li>Configuration guid√©e des essais (MES/MODIF/DEP)</li>
        <li>Tests de 10 fonctions DEIE/eDEIE</li>
        <li>Saisie des r√©sultats OK/NOK avec commentaires</li>
        <li>Signatures √©lectroniques tactiles</li>
        <li>G√©n√©ration PDF professionnelle</li>
        <li>Sauvegarde automatique</li>
        <li>Mode sombre</li>
        <li>G√©olocalisation GPS</li>
        <li>Profils techniciens</li>
      </ul>
    </section>

    <section class="card">
      <h2>üîß Technologies</h2>
      <ul style="line-height: 1.8; margin-left: 20px;">
        <li>HTML5 / CSS3 / JavaScript ES6</li>
        <li>Progressive Web App (PWA)</li>
        <li>jsPDF (g√©n√©ration PDF)</li>
        <li>localStorage (persistance)</li>
        <li>Canvas API (signatures)</li>
        <li>Geolocation API (GPS)</li>
      </ul>
    </section>

    <section class="card">
      <h2>üìÑ Licence</h2>
      <p style="margin: 15px 0; line-height: 1.6;">
        Cette application est distribu√©e sous une licence propri√©taire stricte.<br>
        <a href="LICENSE.txt" style="color: #1424DB; text-decoration: underline;">
          Lire la licence compl√®te (LICENSE.txt)
        </a>
      </p>
      <div style="background-color: #f5f5f5; padding: 15px; border-radius: 6px; margin-top: 15px;">
        <p style="margin: 0; font-size: 0.85rem; color: #666; line-height: 1.5;">
          <strong>En r√©sum√© :</strong><br>
          ‚úÖ Utilisation autoris√©e pour usage interne ENEDIS<br>
          ‚ùå Redistribution interdite<br>
          ‚ùå Modification interdite sans autorisation<br>
          ‚ùå Commercialisation interdite<br>
          ‚ùå Retrait des mentions d'auteur interdit
        </p>
      </div>
    </section>

    <section class="card">
      <h2>üîí Mes donn√©es personnelles (RGPD)</h2>
      <p style="margin: 15px 0; color: #666; line-height: 1.6;">
        Conform√©ment au R√®glement G√©n√©ral sur la Protection des Donn√©es (RGPD), vous disposez 
        de droits sur vos donn√©es personnelles stock√©es par cette application.
      </p>

      <div style="background: #e3f2fd; padding: 15px; border-left: 4px solid #1424DB; border-radius: 6px; margin: 20px 0;">
        <h3 style="margin-top: 0; color: #1424DB;">üìã Donn√©es stock√©es localement :</h3>
        <ul style="line-height: 1.8; margin: 10px 0;">
          <li>Profil technicien (nom, base Enedis)</li>
          <li>Configuration SharePoint</li>
          <li>Donn√©es des essais en cours (temporaire, max 90 jours)</li>
          <li>Signatures √©lectroniques (jusqu'√† g√©n√©ration du PDF)</li>
        </ul>
      </div>

      <div style="display: flex; flex-direction: column; gap: 15px; margin-top: 25px;">
        <button type="button" class="secondary-btn" id="btnExportData" style="background: #2196F3; color: white;">
          üì• Exporter mes donn√©es (JSON)
        </button>
        
        <button type="button" class="secondary-btn" id="btnDeleteAllData" style="background: #d32f2f; color: white;">
          üóëÔ∏è Supprimer toutes mes donn√©es
        </button>

        <a href="confidentialite.html" class="secondary-btn" style="background: #1424DB; color: white; text-decoration: none; text-align: center;">
          üìÑ Consulter la politique de confidentialit√©
        </a>
      </div>

      <div style="background: #fff3cd; padding: 15px; border-left: 4px solid #ffc107; border-radius: 6px; margin-top: 20px;">
        <p style="margin: 0; font-size: 0.9rem; color: #856404; line-height: 1.6;">
          <strong>‚ÑπÔ∏è Vos droits RGPD :</strong><br>
          ‚Ä¢ Droit d'acc√®s √† vos donn√©es (export)<br>
          ‚Ä¢ Droit de rectification (modification)<br>
          ‚Ä¢ Droit √† l'effacement (suppression)<br>
          ‚Ä¢ Droit √† la portabilit√© (export JSON)<br><br>
          Pour toute question : <a href="/cdn-cgi/l/email-protection#3256425d72575c57565b411c5440" style="color: #856404; text-decoration: underline;"><span class="__cf_email__" data-cfemail="bbdfcbd4fbded5dedfd2c895ddc9">[email&#160;protected]</span></a>
        </p>
      </div>
    </section>

    <section class="card">
      <h2>‚öôÔ∏è Configuration SharePoint</h2>
      <p style="margin: 15px 0; color: #666;">
        Configurez l'acc√®s √† votre dossier SharePoint pour l'archivage manuel des PV.
      </p>
      
      <div style="margin-top: 20px;">
        <div style="margin-bottom: 15px;">
          <label style="display: block; margin-bottom: 5px; font-weight: bold;">
            üìÇ Lien direct vers votre dossier SharePoint :
          </label>
          <input 
            type="text" 
            id="sharepointFolderUrl" 
            placeholder="Collez le lien complet de votre dossier ici"
            style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 6px; font-size: 14px;"
          />
          <small style="color: #666; font-size: 0.85rem; margin-top: 5px; display: block;">
            üí° Comment obtenir le lien :<br>
            1. Ouvrez Safari et allez dans votre dossier SharePoint "PV d'essais"<br>
            2. Copiez l'URL compl√®te de la barre d'adresse<br>
            3. Collez-la ici<br>
            Exemple : https://enedis.sharepoint.com/sites/MonSite/Documents/PV%20d'essais
          </small>
        </div>
        
        <div style="margin-bottom: 20px; padding-top: 10px; border-top: 1px solid #e0e0e0;">
          <label style="display: flex; align-items: center; cursor: pointer; margin-bottom: 15px;">
            <input type="checkbox" id="archivageManuelEnabled" style="margin-right: 10px; width: 20px; height: 20px;" checked>
            <span style="font-weight: bold;">üìÇ Activer l'archivage manuel</span>
          </label>
          <small style="color: #666; font-size: 0.85rem; margin-left: 30px; display: block;">
            Permet d'ouvrir SharePoint pour archiver manuellement les PDF
          </small>
        </div>
        
        <div style="display: flex; gap: 10px; flex-wrap: wrap;">
          <button type="button" class="primary-btn" id="btnSaveSharePoint" style="flex: 1;">
            üíæ Enregistrer la configuration
          </button>
          <button type="button" class="secondary-btn" id="btnTestSharePoint" style="flex: 1;">
            üß™ Tester le lien
          </button>
        </div>
        
        <div id="sharepointStatus" style="margin-top: 15px; padding: 10px; border-radius: 6px; display: none;"></div>
      </div>
      
      <div style="background-color: #e3f2fd; border-left: 4px solid #2196F3; padding: 15px; margin-top: 20px; border-radius: 6px;">
        <p style="margin: 0; font-size: 0.9rem; color: #1565C0;">
          ‚ÑπÔ∏è <strong>Note :</strong> Utilisez le lien direct de votre dossier SharePoint. 
          L'app l'ouvrira automatiquement quand vous cliquerez sur "Archivage manuel".
        </p>
      </div>
    </section>

    <section class="card">
      <h2>üìû Contact</h2>
      <p style="margin: 15px 0; color: #666;">
        Pour toute question, demande d'autorisation ou signalement de bug, 
        veuillez contacter l'auteur.
      </p>
    </section>

    <div class="form-actions">
      <button type="button" class="primary-btn" onclick="window.location.href='index.html'">
        Retour √† l'accueil
      </button>
    </div>

  </main>

  <!-- FOOTER COPYRIGHT -->
  <footer class="copyright-footer">
    <p>¬© 2026 Olivier Guillemard - Tous droits r√©serv√©s</p>
    <p class="version">Application Essais DEIE v1.1</p>
    <p class="usage">Usage interne ENEDIS uniquement</p>
  </footer>


  <script defer src="sharepoint-integration.js?v=20260217"></script>
  <script defer src="ux-mobile.js?v=20260217"></script>
  
  <script>
    // ============================================
    // GESTION RGPD - EXPORT ET SUPPRESSION DONN√âES
    // ============================================

    // Export des donn√©es personnelles (Article 20 RGPD - Portabilit√©)
    document.getElementById("btnExportData")?.addEventListener("click", () => {
      try {
        const allData = {
          exportDate: new Date().toISOString(),
          exportVersion: "1.1",
          profilTechnicien: JSON.parse(localStorage.getItem("profilTechnicien") || "null"),
          sharepointConfig: JSON.parse(localStorage.getItem("sharepointConfig") || "null"),
          choixEssais: JSON.parse(localStorage.getItem("choixEssais") || "null"),
          rapportEssais: JSON.parse(localStorage.getItem("rapportEssais") || "null"),
          dataTests: JSON.parse(localStorage.getItem("dataTests") || "null"),
          lastAutoSave: JSON.parse(localStorage.getItem("lastAutoSave") || "null"),
          darkModeEnabled: localStorage.getItem("darkModeEnabled"),
          note: "Export RGPD - Toutes vos donn√©es personnelles stock√©es localement dans l'application Essais DEIE"
        };

        const dataStr = JSON.stringify(allData, null, 2);
        const blob = new Blob([dataStr], { type: 'application/json' });
        const url = URL.createObjectURL(blob);
        
        const a = document.createElement('a');
        a.href = url;
        a.download = 'mes-donnees-DEIE-' + new Date().toISOString().split('T')[0] + '.json';
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
        
        alert("‚úÖ Export r√©ussi !\n\nVos donn√©es ont √©t√© export√©es au format JSON.");
        
      } catch (error) {
        console.error("Erreur export donn√©es:", error);
        alert("‚ùå Erreur lors de l'export des donn√©es.\n\n" + error.message);
      }
    });

    // Suppression de toutes les donn√©es personnelles
    document.getElementById("btnDeleteAllData")?.addEventListener("click", () => {
      const confirmed = confirm(
        "‚ö†Ô∏è SUPPRESSION DE VOS DONN√âES PERSONNELLES\n\n" +
        "Cette action est IRR√âVERSIBLE.\n\n" +
        "Voulez-vous vraiment SUPPRIMER toutes vos donn√©es ?"
      );
      
      if (!confirmed) return;

      const doubleConfirm = confirm("‚ö†Ô∏è CONFIRMATION FINALE\n\n√ätes-vous ABSOLUMENT S√õR(E) ?");
      if (!doubleConfirm) return;

      try {
        localStorage.clear();
        alert("‚úÖ SUPPRESSION EFFECTU√âE\n\nVous allez √™tre redirig√© vers l'accueil.");
        setTimeout(() => { window.location.href = "index.html"; }, 1000);
      } catch (error) {
        console.error("Erreur suppression donn√©es:", error);
        alert("‚ùå Erreur lors de la suppression des donn√©es.\n\n" + error.message);
      }
    });

    // ============================================
    // CONFIGURATION SHAREPOINT
    // ============================================
    
    // Charger la configuration existante
    window.addEventListener('load', function() {
      const config = localStorage.getItem("sharepointConfig");
      if (config) {
        try {
          const parsed = JSON.parse(config);
          document.getElementById("sharepointFolderUrl").value = parsed.folderUrl || "";
          document.getElementById("archivageManuelEnabled").checked = parsed.archivageManuelEnabled !== false;
        } catch (e) {
          console.error("Erreur chargement config SharePoint:", e);
        }
      }
    });
    
    // Sauvegarder la configuration
    document.getElementById("btnSaveSharePoint").addEventListener("click", function() {
      const folderUrl = document.getElementById("sharepointFolderUrl").value.trim();
      const archivageManuelEnabled = document.getElementById("archivageManuelEnabled").checked;
      
      if (archivageManuelEnabled && !folderUrl) {
        alert("‚ùå Veuillez remplir le lien du dossier SharePoint.");
        return;
      }
      
      if (archivageManuelEnabled && !folderUrl.startsWith("https://")) {
        alert("‚ùå Le lien doit commencer par https://");
        return;
      }
      
      const config = {
        folderUrl: folderUrl,
        archivageManuelEnabled: archivageManuelEnabled
      };
      
      localStorage.setItem("sharepointConfig", JSON.stringify(config));
      
      const statusDiv = document.getElementById("sharepointStatus");
      statusDiv.style.display = "block";
      statusDiv.style.backgroundColor = "#d4edda";
      statusDiv.style.borderLeft = "4px solid #28a745";
      statusDiv.style.color = "#155724";
      
      let message = "‚úì Configuration enregistr√©e avec succ√®s !<br>";
      if (archivageManuelEnabled) message += "‚Ä¢ Archivage manuel activ√©";
      
      statusDiv.innerHTML = message;
      
      setTimeout(function() {
        statusDiv.style.display = "none";
      }, 3000);
    });
    
    // Tester le lien SharePoint
    document.getElementById("btnTestSharePoint").addEventListener("click", function() {
      const folderUrl = document.getElementById("sharepointFolderUrl").value.trim();
      const statusDiv = document.getElementById("sharepointStatus");
      
      if (!folderUrl) {
        alert("‚ùå Veuillez d'abord remplir le lien du dossier SharePoint.");
        return;
      }
      
      statusDiv.style.display = "block";
      statusDiv.style.backgroundColor = "#fff3cd";
      statusDiv.style.borderLeft = "4px solid #ffc107";
      statusDiv.style.color = "#856404";
      statusDiv.innerHTML = "‚è≥ Validation en cours...";
      
      try {
        const urlObj = new URL(folderUrl);
        
        if (!urlObj.hostname.includes('sharepoint.com')) {
          throw new Error("Le lien ne semble pas √™tre un dossier SharePoint");
        }
        
        statusDiv.style.backgroundColor = "#d4edda";
        statusDiv.style.borderLeft = "4px solid #28a745";
        statusDiv.style.color = "#155724";
        statusDiv.innerHTML = "";
        
        const successMsg = document.createElement('div');
        successMsg.innerHTML = '‚úì Lien valide !';
        statusDiv.appendChild(successMsg);
        
        const urlInfo = document.createElement('small');
        urlInfo.style.fontSize = '0.85em';
        urlInfo.style.marginTop = '5px';
        urlInfo.style.display = 'block';
        urlInfo.textContent = 'Lien : ' + folderUrl;
        statusDiv.appendChild(urlInfo);
        
        const openBtn = document.createElement('button');
        openBtn.textContent = 'üîó Ouvrir le dossier pour v√©rifier';
        openBtn.style.cssText = 'margin-top: 10px; padding: 5px 15px; background: #28a745; color: white; border: none; border-radius: 4px; cursor: pointer;';
        openBtn.onclick = function() {
          window.open(folderUrl, '_blank');
        };
        statusDiv.appendChild(openBtn);
        
      } catch (error) {
        statusDiv.style.backgroundColor = "#f8d7da";
        statusDiv.style.borderLeft = "4px solid #dc3545";
        statusDiv.style.color = "#721c24";
        statusDiv.innerHTML = 
          "‚ùå Lien invalide : " + error.message + "<br>" +
          "<small style='font-size: 0.85em; margin-top: 5px; display: block;'>" +
          "Assurez-vous de copier le lien complet depuis Safari." +
          "</small>";
      }
      
      setTimeout(function() {
        statusDiv.style.display = "none";
      }, 8000);
    });
  </script>
  <script defer src="dark-mode.js?v=20260217"></script>
</body>
</html>
