<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Ã€ propos - Essais DEIE</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="style.css?v=20260217">
</head>

<body>

  <!-- HEADER BLEU -->
  <header class="header">
    <img src="enedis.png" alt="Enedis" class="logo">
    <h1>Essais DEIE</h1>
    <p>Ã€ propos</p>
  </header>

  <!-- CONTENU -->
  <main class="container">

    <section class="card">
      <h2>ğŸ“± Application Essais DEIE</h2>
      <p style="text-align: center; font-size: 1.5rem; font-weight: bold; color: #1424DB; margin: 20px 0;">
        Version 1.1
      </p>
      <p style="text-align: center; color: #666; margin-bottom: 30px;">
        FÃ©vrier 2026
      </p>
    </section>

    <section class="card">
      <h2>ğŸ‘¤ Auteur</h2>
      <p style="font-size: 1.1rem; margin: 15px 0;">
        <strong>Olivier Guillemard</strong>
      </p>
      <p style="color: #666;">
        DÃ©veloppeur de l'application
      </p>
    </section>

    <section class="card">
      <h2>ğŸ“œ Droits d'auteur</h2>
      <p style="margin: 15px 0;">
        <strong>Copyright Â© 2026 Olivier Guillemard</strong>
      </p>
      <p style="color: #666; margin: 10px 0;">
        Tous droits rÃ©servÃ©s. Cette application et son code source sont la propriÃ©tÃ© exclusive de l'auteur.
      </p>
      <div style="background-color: #fff3cd; border-left: 4px solid #ffc107; padding: 15px; margin: 20px 0; border-radius: 6px;">
        <p style="margin: 0; font-weight: bold; color: #856404;">
          âš ï¸ Usage interne ENEDIS uniquement
        </p>
        <p style="margin: 10px 0 0 0; color: #856404; font-size: 0.9rem;">
          Toute reproduction, modification ou redistribution non autorisÃ©e est strictement interdite.
        </p>
      </div>
    </section>

    <section class="card">
      <h2>ğŸ“‹ Description</h2>
      <p style="margin: 15px 0; line-height: 1.6;">
        Application web mobile pour la gestion et la documentation des procÃ©dures d'essais DEIE 
        (Dispositif d'Ã‰change d'Information d'Exploitation) conformes aux normes ENEDIS.
      </p>
      <h3 style="color: #1424DB; margin-top: 20px;">FonctionnalitÃ©s principales :</h3>
      <ul style="line-height: 1.8; margin-left: 20px;">
        <li>Configuration guidÃ©e des essais (MES/MODIF/DEP)</li>
        <li>Tests de 10 fonctions DEIE/eDEIE</li>
        <li>Saisie des rÃ©sultats OK/NOK avec commentaires</li>
        <li>Signatures Ã©lectroniques tactiles</li>
        <li>GÃ©nÃ©ration PDF professionnelle</li>
        <li>Sauvegarde automatique</li>
        <li>Mode sombre</li>
        <li>GÃ©olocalisation GPS</li>
        <li>Profils techniciens</li>
      </ul>
    </section>

    <section class="card">
      <h2>ğŸ”§ Technologies</h2>
      <ul style="line-height: 1.8; margin-left: 20px;">
        <li>HTML5 / CSS3 / JavaScript ES6</li>
        <li>Progressive Web App (PWA)</li>
        <li>jsPDF (gÃ©nÃ©ration PDF)</li>
        <li>localStorage (persistance)</li>
        <li>Canvas API (signatures)</li>
        <li>Geolocation API (GPS)</li>
      </ul>
    </section>

    <section class="card">
      <h2>ğŸ“„ Licence</h2>
      <p style="margin: 15px 0; line-height: 1.6;">
        Cette application est distribuÃ©e sous une licence propriÃ©taire stricte.<br>
        <a href="LICENSE.txt" style="color: #1424DB; text-decoration: underline;">
          Lire la licence complÃ¨te (LICENSE.txt)
        </a>
      </p>
      <div style="background-color: #f5f5f5; padding: 15px; border-radius: 6px; margin-top: 15px;">
        <p style="margin: 0; font-size: 0.85rem; color: #666; line-height: 1.5;">
          <strong>En rÃ©sumÃ© :</strong><br>
          âœ… Utilisation autorisÃ©e pour usage interne ENEDIS<br>
          âŒ Redistribution interdite<br>
          âŒ Modification interdite sans autorisation<br>
          âŒ Commercialisation interdite<br>
          âŒ Retrait des mentions d'auteur interdit
        </p>
      </div>
    </section>

    <section class="card">
      <h2>ğŸ”’ Mes donnÃ©es personnelles (RGPD)</h2>
      <p style="margin: 15px 0; color: #666; line-height: 1.6;">
        ConformÃ©ment au RÃ¨glement GÃ©nÃ©ral sur la Protection des DonnÃ©es (RGPD), vous disposez 
        de droits sur vos donnÃ©es personnelles stockÃ©es par cette application.
      </p>

      <div style="background: #e3f2fd; padding: 15px; border-left: 4px solid #1424DB; border-radius: 6px; margin: 20px 0;">
        <h3 style="margin-top: 0; color: #1424DB;">ğŸ“‹ DonnÃ©es stockÃ©es localement :</h3>
        <ul style="line-height: 1.8; margin: 10px 0;">
          <li>Profil technicien (nom, base Enedis)</li>
          <li>Configuration SharePoint</li>
          <li>DonnÃ©es des essais en cours (temporaire, max 90 jours)</li>
          <li>Signatures Ã©lectroniques (jusqu'Ã  gÃ©nÃ©ration du PDF)</li>
        </ul>
      </div>

      <div style="display: flex; flex-direction: column; gap: 15px; margin-top: 25px;">
        <button type="button" class="secondary-btn" id="btnExportData" style="background: #2196F3; color: white;">
          ğŸ“¥ Exporter mes donnÃ©es (JSON)
        </button>
        
        <button type="button" class="secondary-btn" id="btnDeleteAllData" style="background: #d32f2f; color: white;">
          ğŸ—‘ï¸ Supprimer toutes mes donnÃ©es
        </button>

        <a href="confidentialite.html" class="secondary-btn" style="background: #1424DB; color: white; text-decoration: none; text-align: center;">
          ğŸ“„ Consulter la politique de confidentialitÃ©
        </a>
      </div>

      <div style="background: #fff3cd; padding: 15px; border-left: 4px solid #ffc107; border-radius: 6px; margin-top: 20px;">
        <p style="margin: 0; font-size: 0.9rem; color: #856404; line-height: 1.6;">
          <strong>â„¹ï¸ Vos droits RGPD :</strong><br>
          â€¢ Droit d'accÃ¨s Ã  vos donnÃ©es (export)<br>
          â€¢ Droit de rectification (modification)<br>
          â€¢ Droit Ã  l'effacement (suppression)<br>
          â€¢ Droit Ã  la portabilitÃ© (export JSON)<br><br>
          Pour toute question : <a href="/cdn-cgi/l/email-protection#3256425d72575c57565b411c5440" style="color: #856404; text-decoration: underline;"><span class="__cf_email__" data-cfemail="bbdfcbd4fbded5dedfd2c895ddc9">[email&#160;protected]</span></a>
        </p>
      </div>
    </section>

    <section class="card">
      <h2>âš™ï¸ Configuration SharePoint</h2>
      <p style="margin: 15px 0; color: #666;">
        Configurez l'accÃ¨s Ã  votre dossier SharePoint pour l'archivage manuel des PV.
      </p>
      
      <div style="margin-top: 20px;">
        <div style="margin-bottom: 15px;">
          <label style="display: block; margin-bottom: 5px; font-weight: bold;">
            ğŸ“‚ Lien direct vers votre dossier SharePoint :
          </label>
          <input 
            type="text" 
            id="sharepointFolderUrl" 
            placeholder="Collez le lien complet de votre dossier ici"
            style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 6px; font-size: 14px;"
          />
          <small style="color: #666; font-size: 0.85rem; margin-top: 5px; display: block;">
            ğŸ’¡ Comment obtenir le lien :<br>
            1. Ouvrez Safari et allez dans votre dossier SharePoint "PV d'essais"<br>
            2. Copiez l'URL complÃ¨te de la barre d'adresse<br>
            3. Collez-la ici<br>
            Exemple : https://enedis.sharepoint.com/sites/MonSite/Documents/PV%20d'essais
          </small>
        </div>
        
        <div style="margin-bottom: 20px; padding-top: 10px; border-top: 1px solid #e0e0e0;">
          <label style="display: flex; align-items: center; cursor: pointer; margin-bottom: 15px;">
            <input type="checkbox" id="archivageManuelEnabled" style="margin-right: 10px; width: 20px; height: 20px;" checked>
            <span style="font-weight: bold;">ğŸ“‚ Activer l'archivage manuel</span>
          </label>
          <small style="color: #666; font-size: 0.85rem; margin-left: 30px; display: block;">
            Permet d'ouvrir SharePoint pour archiver manuellement les PDF
          </small>
        </div>
        
        <div style="display: flex; gap: 10px; flex-wrap: wrap;">
          <button type="button" class="primary-btn" id="btnSaveSharePoint" style="flex: 1;">
            ğŸ’¾ Enregistrer la configuration
          </button>
          <button type="button" class="secondary-btn" id="btnTestSharePoint" style="flex: 1;">
            ğŸ§ª Tester le lien
          </button>
        </div>
        
        <div id="sharepointStatus" style="margin-top: 15px; padding: 10px; border-radius: 6px; display: none;"></div>
      </div>
      
      <div style="background-color: #e3f2fd; border-left: 4px solid #2196F3; padding: 15px; margin-top: 20px; border-radius: 6px;">
        <p style="margin: 0; font-size: 0.9rem; color: #1565C0;">
          â„¹ï¸ <strong>Note :</strong> Utilisez le lien direct de votre dossier SharePoint. 
          L'app l'ouvrira automatiquement quand vous cliquerez sur "Archivage manuel".
        </p>
      </div>
    </section>

    <section class="card">
      <h2>ğŸ“ Contact</h2>
      <p style="margin: 15px 0; color: #666;">
        Pour toute question, demande d'autorisation ou signalement de bug, 
        veuillez contacter l'auteur.
      </p>
    </section>

    <div class="form-actions">
      <button type="button" class="primary-btn" onclick="window.location.href='index.html'">
        Retour Ã  l'accueil
      </button>
    </div>

  </main>

  <!-- FOOTER COPYRIGHT -->
  <footer class="copyright-footer">
    <p>Â© 2026 Olivier Guillemard - Tous droits rÃ©servÃ©s</p>
    <p class="version">Application Essais DEIE v1.1</p>
    <p class="usage">Usage interne ENEDIS uniquement</p>
  </footer>

  <script data-cfasync="false" src="/cdn-cgi/scripts/5c5dd728/cloudflare-static/email-decode.min.js"></script><script defer src="sharepoint-integration.js?v=20260217"></script>
  <script defer src="ux-mobile.js?v=20260217"></script>
  
  <script>
    // ============================================
    // GESTION RGPD - EXPORT ET SUPPRESSION DONNÃ‰ES
    // ============================================

    // Export des donnÃ©es personnelles (Article 20 RGPD - PortabilitÃ©)
    document.getElementById("btnExportData")?.addEventListener("click", () => {
      try {
        // Collecter toutes les donnÃ©es de l'utilisateur
        const allData = {
          exportDate: new Date().toISOString(),
          exportVersion: "1.1",
          
          profilTechnicien: JSON.parse(localStorage.getItem("profilTechnicien") || "null"),
          sharepointConfig: JSON.parse(localStorage.getItem("sharepointConfig") || "null"),
          
          // DonnÃ©es de session en cours (si existantes)
          choixEssais: JSON.parse(localStorage.getItem("choixEssais") || "null"),
          rapportEssais: JSON.parse(localStorage.getItem("rapportEssais") || "null"),
          dataTests: JSON.parse(localStorage.getItem("dataTests") || "null"),
          
          // MÃ©tadonnÃ©es
          lastAutoSave: JSON.parse(localStorage.getItem("lastAutoSave") || "null"),
          darkModeEnabled: localStorage.getItem("darkModeEnabled"),
          
          // Info pour l'utilisateur
          note: "Export RGPD - Toutes vos donnÃ©es personnelles stockÃ©es localement dans l'application Essais DEIE"
        };

        // CrÃ©er le fichier JSON
        const dataStr = JSON.stringify(allData, null, 2);
        const blob = new Blob([dataStr], { type: 'application/json' });
        const url = URL.createObjectURL(blob);
        
        // TÃ©lÃ©charger
        const a = document.createElement('a');
        a.href = url;
        a.download = 'mes-donnees-DEIE-' + new Date().toISOString().split('T')[0] + '.json';
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
        
        alert("âœ… Export rÃ©ussi !\n\nVos donnÃ©es ont Ã©tÃ© exportÃ©es au format JSON.\n\nVous pouvez les consulter, les archiver ou les transmettre conformÃ©ment Ã  votre droit Ã  la portabilitÃ© (Article 20 RGPD).");
        
      } catch (error) {
        console.error("Erreur export donnÃ©es:", error);
        alert("âŒ Erreur lors de l'export des donnÃ©es.\n\n" + error.message);
      }
    });

    // Suppression de toutes les donnÃ©es personnelles (Article 17 RGPD - Effacement)
    document.getElementById("btnDeleteAllData")?.addEventListener("click", () => {
      const confirmed = confirm(
        "âš ï¸ SUPPRESSION DE VOS DONNÃ‰ES PERSONNELLES\n\n" +
        "ConformÃ©ment Ã  l'Article 17 du RGPD (droit Ã  l'effacement), vous pouvez supprimer toutes vos donnÃ©es personnelles.\n\n" +
        "ATTENTION : Cette action est IRRÃ‰VERSIBLE.\n\n" +
        "Seront supprimÃ©s :\n" +
        "â€¢ Votre profil technicien\n" +
        "â€¢ Les essais en cours (non finalisÃ©s)\n" +
        "â€¢ La configuration SharePoint\n" +
        "â€¢ Toutes les sauvegardes automatiques\n\n" +
        "âš ï¸ Les PDF dÃ©jÃ  gÃ©nÃ©rÃ©s et archivÃ©s sur SharePoint ne seront PAS supprimÃ©s (obligation lÃ©gale de conservation 10 ans).\n\n" +
        "Voulez-vous vraiment SUPPRIMER toutes vos donnÃ©es ?"
      );
      
      if (!confirmed) return;

      // Double confirmation pour action critique
      const doubleConfirm = confirm(
        "âš ï¸ CONFIRMATION FINALE\n\n" +
        "ÃŠtes-vous ABSOLUMENT SÃ›R(E) de vouloir supprimer toutes vos donnÃ©es ?\n\n" +
        "Cette action ne peut pas Ãªtre annulÃ©e."
      );

      if (!doubleConfirm) return;

      try {
        // Supprimer toutes les donnÃ©es localStorage
        localStorage.clear();
        
        // Message de confirmation
        alert(
          "âœ… SUPPRESSION EFFECTUÃ‰E\n\n" +
          "Toutes vos donnÃ©es personnelles stockÃ©es localement ont Ã©tÃ© supprimÃ©es.\n\n" +
          "ConformÃ©ment au RGPD :\n" +
          "â€¢ DonnÃ©es locales : SUPPRIMÃ‰ES âœ“\n" +
          "â€¢ Archives lÃ©gales (PV archivÃ©s) : ConservÃ©es 10 ans (obligation lÃ©gale)\n\n" +
          "Vous allez Ãªtre redirigÃ© vers l'accueil."
        );

        // Rediriger vers l'accueil
        setTimeout(() => {
          window.location.href = "index.html";
        }, 1000);

      } catch (error) {
        console.error("Erreur suppression donnÃ©es:", error);
        alert("âŒ Erreur lors de la suppression des donnÃ©es.\n\n" + error.message);
      }
    });

    // ============================================
    // CONFIGURATION SHAREPOINT (code existant)
    // ============================================
    
    // Charger la configuration SharePoint existante
    window.addEventListener('load', () => {
      const config = localStorage.getItem("sharepointConfig");
      if (config) {
        const parsed = JSON.parse(config);
        // Charger le lien complet du dossier
        document.getElementById("sharepointFolderUrl").value = parsed.folderUrl || "";
        document.getElementById("archivageManuelEnabled").checked = parsed.archivageManuelEnabled !== false;
      }
    });
    
    // Sauvegarder la configuration SharePoint
    document.getElementById("btnSaveSharePoint")?.addEventListener("click", () => {
      const folderUrl = document.getElementById("sharepointFolderUrl").value.trim();
      const archivageManuelEnabled = document.getElementById("archivageManuelEnabled").checked;
      
      if (archivageManuelEnabled && !folderUrl) {
        alert("âŒ Veuillez remplir le lien du dossier SharePoint.");
        return;
      }
      
      // Valider l'URL
      if (archivageManuelEnabled && !folderUrl.startsWith("https://")) {
        alert("âŒ Le lien doit commencer par https://");
        return;
      }
      
      // Sauvegarder la config
      const config = {
        folderUrl: folderUrl,
        archivageManuelEnabled: archivageManuelEnabled
      };
      localStorage.setItem("sharepointConfig", JSON.stringify(config));
      
      const statusDiv = document.getElementById("sharepointStatus");
      statusDiv.style.display = "block";
      statusDiv.style.backgroundColor = "#d4edda";
      statusDiv.style.borderLeft = "4px solid #28a745";
      statusDiv.style.color = "#155724";
      
      let message = "âœ“ Configuration enregistrÃ©e avec succÃ¨s !<br>";
      if (archivageManuelEnabled) message += "â€¢ Archivage manuel activÃ©";
      
      statusDiv.innerHTML = message;
      
      setTimeout(() => {
        statusDiv.style.display = "none";
      }, 3000);
    });
    
    // Tester le lien SharePoint
    document.getElementById("btnTestSharePoint")?.addEventListener("click", () => {
      const folderUrl = document.getElementById("sharepointFolderUrl").value.trim();
      const statusDiv = document.getElementById("sharepointStatus");
      
      if (!folderUrl) {
        alert("âŒ Veuillez d'abord remplir le lien du dossier SharePoint.");
        return;
      }
      
      statusDiv.style.display = "block";
      statusDiv.style.backgroundColor = "#fff3cd";
      statusDiv.style.borderLeft = "4px solid #ffc107";
      statusDiv.style.color = "#856404";
      statusDiv.innerHTML = "â³ Validation en cours...";
      
      // Validation de l'URL
      try {
        // VÃ©rifier que c'est une URL valide
        const urlObj = new URL(folderUrl);
        
        // VÃ©rifier que c'est bien SharePoint
        if (!urlObj.hostname.includes('sharepoint.com')) {
          throw new Error("Le lien ne semble pas Ãªtre un dossier SharePoint");
        }
        
        // Afficher succÃ¨s
        statusDiv.style.backgroundColor = "#d4edda";
        statusDiv.style.borderLeft = "4px solid #28a745";
        statusDiv.style.color = "#155724";
        
        // CrÃ©er les Ã©lÃ©ments de faÃ§on sÃ©curisÃ©e
        statusDiv.innerHTML = '';
        
        const successMsg = document.createElement('div');
        successMsg.innerHTML = 'âœ“ Lien valide !';
        statusDiv.appendChild(successMsg);
        
        const urlInfo = document.createElement('small');
        urlInfo.style.fontSize = '0.85em';
        urlInfo.style.marginTop = '5px';
        urlInfo.style.display = 'block';
        urlInfo.textContent = 'Lien : ' + folderUrl;
        statusDiv.appendChild(urlInfo);
        
        const openBtn = document.createElement('button');
        openBtn.textContent = 'ğŸ”— Ouvrir le dossier pour vÃ©rifier';
        openBtn.style.cssText = 'margin-top: 10px; padding: 5px 15px; background: #28a745; color: white; border: none; border-radius: 4px; cursor: pointer;';
        openBtn.addEventListener('click', () => {
          window.open(folderUrl, '_blank');
        });
        statusDiv.appendChild(openBtn);
        
      } catch (error) {
        statusDiv.style.backgroundColor = "#f8d7da";
        statusDiv.style.borderLeft = "4px solid #dc3545";
        statusDiv.style.color = "#721c24";
        statusDiv.innerHTML = `
          âŒ Lien invalide : ${error.message}<br>
          <small style="font-size: 0.85em; margin-top: 5px; display: block;">
            Assurez-vous de copier le lien complet depuis Safari quand vous Ãªtes dans le dossier.
          </small>
        `;
      }
      
      setTimeout(() => {
        statusDiv.style.display = "none";
      }, 8000);
    });
  </script>
  <script defer src="dark-mode.js?v=20260217"></script>
</body>
</html>
